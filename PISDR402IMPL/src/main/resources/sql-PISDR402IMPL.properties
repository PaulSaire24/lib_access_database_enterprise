#Queries for quotation service
PISD.INSERT_INSURANCE_QUOTATION=conPISD;INSERT INTO PISD.T_PISD_INSURANCE_QUOTATION (POLICY_QUOTA_INTERNAL_ID, INSURANCE_SIMULATION_ID, INSURANCE_COMPANY_QUOTA_ID, QUOTE_DATE, QUOTA_HMS_DATE, POLICY_QUOTA_END_VALIDITY_DATE, CUSTOMER_ID, POLICY_QUOTA_STATUS_TYPE, LAST_CHANGE_BRANCH_ID, SOURCE_BRANCH_ID, CREATION_USER_ID, CREATION_DATE, USER_AUDIT_ID, AUDIT_DATE, PERSONAL_DOC_TYPE, PARTICIPANT_PERSONAL_ID, INSURED_CUSTOMER_NAME, CLIENT_LAST_NAME, RFQ_INTERNAL_ID) VALUES (:POLICY_QUOTA_INTERNAL_ID, :INSURANCE_SIMULATION_ID, :INSURANCE_COMPANY_QUOTA_ID, TO_DATE(:QUOTE_DATE, 'DD/MM/YYYY'),SYSTIMESTAMP, TO_DATE(:POLICY_QUOTA_END_VALIDITY_DATE, 'YYYY-MM-DD'), :CUSTOMER_ID, :POLICY_QUOTA_STATUS_TYPE, :LAST_CHANGE_BRANCH_ID, :SOURCE_BRANCH_ID, :CREATION_USER_ID, SYSTIMESTAMP, :USER_AUDIT_ID, SYSTIMESTAMP, :PERSONAL_DOC_TYPE, :PARTICIPANT_PERSONAL_ID, :INSURED_CUSTOMER_NAME, :CLIENT_LAST_NAME, :RFQ_INTERNAL_ID)
PISD.INSERT_INSURANCE_QUOTATION_MOD=conPISD; INSERT INTO PISD.T_PISD_INSRNC_QUOTATION_MOD (POLICY_QUOTA_INTERNAL_ID, INSURANCE_PRODUCT_ID, INSURANCE_MODALITY_TYPE, SALE_CHANNEL_ID, PAYMENT_TERM_NUMBER, POLICY_PAYMENT_FREQUENCY_TYPE, FINANCING_START_DATE, FINANCING_END_DATE, PREMIUM_AMOUNT, PREMIUM_CURRENCY_ID, SAVED_QUOTATION_IND_TYPE, LAST_CHANGE_BRANCH_ID, SOURCE_BRANCH_ID, POLICY_QUOTA_STATUS_TYPE, CREATION_USER_ID, CREATION_DATE, USER_AUDIT_ID, AUDIT_DATE, CONTACT_EMAIL_DESC, CUSTOMER_PHONE_DESC, DATA_TREATMENT_IND_TYPE) VALUES (:POLICY_QUOTA_INTERNAL_ID, :INSURANCE_PRODUCT_ID, :INSURANCE_MODALITY_TYPE, :SALE_CHANNEL_ID, :PAYMENT_TERM_NUMBER, :POLICY_PAYMENT_FREQUENCY_TYPE, TO_DATE(:FINANCING_START_DATE, 'YYYY-MM-DD'), TO_DATE(:FINANCING_END_DATE, 'YYYY-MM-DD'), :PREMIUM_AMOUNT, :PREMIUM_CURRENCY_ID, :SAVED_QUOTATION_IND_TYPE, :LAST_CHANGE_BRANCH_ID, :SOURCE_BRANCH_ID, 'COT', :CREATION_USER_ID, SYSTIMESTAMP, :USER_AUDIT_ID, SYSTIMESTAMP, :CONTACT_EMAIL_DESC, :CUSTOMER_PHONE_DESC, :DATA_TREATMENT_IND_TYPE)

PISD.GET_COMPANY_MODALITIES_BY_PRODUCT_AND_CHANNEL=conPISD; SELECT MOD.INSURANCE_COMPANY_MODALITY_ID FROM PISD.T_PISD_INSRNC_PRD_MODALITY MOD LEFT JOIN PISD.T_PISD_INSURANCE_MOD_SCHAN MS ON MOD.INSURANCE_PRODUCT_ID = MS.INSURANCE_PRODUCT_ID  AND MOD.INSURANCE_MODALITY_TYPE = MS.INSURANCE_MODALITY_TYPE WHERE MOD.INSURANCE_PRODUCT_ID = :INSURANCE_PRODUCT_ID AND MOD.INSURANCE_MODALITY_TYPE IN (:INSURANCE_MODALITY_TYPE) AND MS.SALE_CHANNEL_ID = :SALE_CHANNEL_ID
PISD.GET_MODALITY_TYPE_BY_PRODUCT_ID=conPISD; SELECT pm.INSURANCE_COMPANY_MODALITY_ID, pm.INSURANCE_MODALITY_NAME, pm.INSURANCE_MODALITY_TYPE, ms.PUBLICATION_ORDER_NUMBER FROM PISD.T_PISD_INSRNC_PRD_MODALITY pm LEFT JOIN PISD.T_PISD_INSURANCE_MOD_SCHAN ms ON pm.INSURANCE_PRODUCT_ID = ms.INSURANCE_PRODUCT_ID AND pm.INSURANCE_MODALITY_TYPE = ms.INSURANCE_MODALITY_TYPE WHERE pm.INSURANCE_PRODUCT_ID = :INSURANCE_PRODUCT_ID AND ms.SALE_CHANNEL_ID = :SALE_CHANNEL_ID ORDER BY ms.PUBLICATION_ORDER_NUMBER
PISD.GET_SIMULATION_BY_COMPANY_SIMULATION_ID =conPISD; SELECT INSURANCE_SIMULATION_ID,CUSTOMER_ID,PERSONAL_DOC_TYPE,PARTICIPANT_PERSONAL_ID FROM PISD.T_PISD_INSURANCE_SIMULATION WHERE INSRNC_COMPANY_SIMULATION_ID = :INSRNC_COMPANY_SIMULATION_ID
PISD.INSERT_SIMULATE_ENTERPRISE=conPISD;INSERT INTO PISD.T_PISD_INSURANCE_SIMULATION (INSURANCE_SIMULATION_ID, INSRNC_COMPANY_SIMULATION_ID, CUSTOMER_ID, CUSTOMER_SIMULATION_DATE, CUST_SIMULATION_EXPIRED_DATE, BANK_FACTOR_TYPE, BANK_FACTOR_AMOUNT, BANK_FACTOR_PER, REGISTRY_SITUATION_TYPE, SOURCE_BRANCH_ID, CREATION_USER_ID, CREATION_DATE, USER_AUDIT_ID, AUDIT_DATE, PERSONAL_DOC_TYPE, PARTICIPANT_PERSONAL_ID, INSURED_CUSTOMER_NAME, CLIENT_LAST_NAME, CUSTOMER_SEGMENT_NAME) VALUES (:INSURANCE_SIMULATION_ID, :INSRNC_COMPANY_SIMULATION_ID, :CUSTOMER_ID, TO_DATE(:CUSTOMER_SIMULATION_DATE, 'DD/MM/YYYY'), TO_DATE(:CUST_SIMULATION_EXPIRED_DATE, 'DD/MM/YYYY'), :BANK_FACTOR_TYPE, :BANK_FACTOR_AMOUNT, :BANK_FACTOR_PER, '01', :SOURCE_BRANCH_ID, :CREATION_USER_ID, SYSTIMESTAMP, :USER_AUDIT_ID, SYSTIMESTAMP, :PERSONAL_DOC_TYPE, :PARTICIPANT_PERSONAL_ID, :INSURED_CUSTOMER_NAME, :CLIENT_LAST_NAME, :CUSTOMER_SEGMENT_NAME)
PISD.INSERT_INSRNC_SIMLT_PRD_ENTERPRISE=conPISD;INSERT INTO PISD.T_PISD_INSRNC_SIMLT_PRD (INSURANCE_SIMULATION_ID, INSURANCE_PRODUCT_ID, CAMPAIGN_FACTOR_TYPE, CAMPAIGN_OFFER_1_AMOUNT, CAMPAIGN_FACTOR_PER, SALE_CHANNEL_ID, REGISTRY_SITUATION_TYPE, SOURCE_BRANCH_ID, CREATION_USER_ID, CREATION_DATE, USER_AUDIT_ID, AUDIT_DATE) VALUES (:INSURANCE_SIMULATION_ID, :INSURANCE_PRODUCT_ID, :CAMPAIGN_FACTOR_TYPE, :CAMPAIGN_OFFER_1_AMOUNT, :CAMPAIGN_FACTOR_PER, :SALE_CHANNEL_ID, '01', :SOURCE_BRANCH_ID, :CREATION_USER_ID, SYSTIMESTAMP, :USER_AUDIT_ID, SYSTIMESTAMP)
PISD.SELECT_INSURANCE_SIMULATION_ID_ENTERPRISE=conPISD;SELECT PISD.Q_PISD_SIMULATION_ID0.NEXTVAL FROM DUAL
PISD.DELETE_INSURED_QUOTATION_ENTERPRISE=conPISD; DELETE FROM PISD.T_PISD_INSURANCE_QUOTATION WHERE POLICY_QUOTA_INTERNAL_ID = :POLICY_QUOTA_INTERNAL_ID
#Quotation List
PISD.GET_LIST_QUOTATIONS_BY_CUSTOMERID=conPISD; SELECT  QT.POLICY_QUOTA_INTERNAL_ID,  TO_CHAR(QT.QUOTE_DATE,'YYYY-MM-DD') as QUOTE_DATE,  QT.POLICY_QUOTA_STATUS_TYPE AS QUOTE_STATUS,  TO_CHAR(QM.FINANCING_START_DATE,'YYYY-MM-DD') AS FINANCING_START_DATE,  TO_CHAR(QM.FINANCING_END_DATE,'YYYY-MM-DD') AS FINANCING_END_DATE,  QM.PREMIUM_AMOUNT, QM.PREMIUM_CURRENCY_ID,  QM.PAYMENT_TERM_NUMBER AS NUMBER_PAYMENTS,  CT.INSRNC_CO_CONTRACT_STATUS_TYPE AS CO_STATUS,  PR.INSURANCE_PRODUCT_TYPE,  PR.INSURANCE_PRODUCT_DESC,  MD.INSURANCE_MODALITY_TYPE,  MD.INSURANCE_MODALITY_NAME,  PP.PAYMENT_FREQUENCY_NAME,  PP.PAYMENT_FREQUENCY_ID, QM.SALE_CHANNEL_ID, QT.RFQ_INTERNAL_ID FROM PISD.T_PISD_INSRNC_QUOTATION_MOD QM  INNER JOIN PISD.T_PISD_INSURANCE_QUOTATION QT  ON QM.POLICY_QUOTA_INTERNAL_ID = QT.POLICY_QUOTA_INTERNAL_ID  LEFT JOIN PISD.T_PISD_INSURANCE_CONTRACT CT  ON QT.POLICY_QUOTA_INTERNAL_ID = CT.POLICY_QUOTA_INTERNAL_ID  LEFT JOIN PISD.T_PISD_INSRNC_PAYMENT_PERIOD PP  ON CT.PAYMENT_FREQUENCY_ID = PP.PAYMENT_FREQUENCY_ID  INNER JOIN PISD.T_PISD_INSURANCE_PRODUCT PR  ON QM.INSURANCE_PRODUCT_ID = PR.INSURANCE_PRODUCT_ID  INNER JOIN PISD.T_PISD_INSRNC_PRD_MODALITY MD  ON QM.INSURANCE_MODALITY_TYPE = MD.INSURANCE_MODALITY_TYPE  AND PR.INSURANCE_PRODUCT_ID = MD.INSURANCE_PRODUCT_ID  WHERE  QT.CUSTOMER_ID = :CUSTOMER_ID  AND PR.PRODUCT_SHORT_DESC = :PRODUCT_NAME AND QM.SALE_CHANNEL_ID = :CHANNEL_ID AND TO_CHAR(QT.CREATION_DATE,'YYYY-MM-DD') >= TO_CHAR(SYSDATE-30,'YYYY-MM-DD')  ORDER BY QT.CREATION_DATE DESC 

#Modify quotation
PISD.DELETE_QUOTATION_MOD=conPISD; DELETE FROM PISD.T_PISD_INSRNC_QUOTATION_MOD WHERE POLICY_QUOTA_INTERNAL_ID = :POLICY_QUOTA_INTERNAL_ID AND INSURANCE_PRODUCT_ID = :INSURANCE_PRODUCT_ID

PISD.VALIDATE_IF_QUOTATION_MOD_EXISTS =conPISD; SELECT COUNT(POLICY_QUOTA_INTERNAL_ID) AS RESULT_NUMBER FROM PISD.T_PISD_INSRNC_QUOTATION_MOD WHERE POLICY_QUOTA_INTERNAL_ID = :POLICY_QUOTA_INTERNAL_ID AND INSURANCE_PRODUCT_ID = :INSURANCE_PRODUCT_ID


